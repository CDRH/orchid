<%# expects
  - "sort_by" sort value (e.g. "count|desc")
%>

<%= render_overridable "items", "browse_facet_header" %>

<nav>
  <ul class="nav nav-tabs buffer-bottom" role="tablist">
    <% @page_facets.each_with_index do |(facet_name, facet_info), index| %>
      <li role="presentation" class="<%= active?(facet_name, @browse_facet) %>">
        <% if facet_name == @browse_facet %>
          <%# TODO Fix a11y - Shouldn't be in tab order / focusable %>
          <a href="#"><%= facet_info["label"] %></a>
        <% else %>
          <% id = facet_name.parameterize(separator: ".") %>
          <%= link_to prefix_path("browse_facet_path", facet: id),
            "aria-controls": id, role: "tab" do %>
            <%= facet_info["label"] %>
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
</nav>

<ul class="list-unstyled">
  <% @res[@browse_facet].each do |key, value| %>
    <% selected = facet_selected?(@browse_facet, key) %>
    <%# value_label translates language if necessary,
        create_label puts default label if empty %>
    <% label = create_label(value_label(@browse_facet, key),
        t("search.filters.no_label", default: "No Label")) %>
    <%# list item %>
    <% if !selected %>
      <li>
        <%= link_to label, prefix_path(route_path,
          facet_link(@browse_facet, key)), rel: "nofollow" %>
        <span class="badge"><%= value %></span>
      </li>
    <% else %>
      <li class="selected">
        <span><%= label %></span>
        <span class="badge"><%= value %></span>
        <%= link_to prefix_path(route_path,
          remove_facet(@browse_facet, key)), rel: "nofollow" do %>
          <button class="btn btn-default btn-xs"
                  title="<%= t("search.filters.clear", label: @page_facets[@browse_facet]['label'], default: "Clear #{@page_facets[@browse_facet]['label']} Filter") %>"
                  aria-label="<%= t("search.filters.clear", label: @page_facets[@browse_facet]['label'], default: "Clear #{@page_facets[@browse_facet]['label']} Filter") %>">
            <span class="pull-right glyphicon glyphicon-remove" aria-hidden="true"></span>
          </button>
        <% end %>
      </li>
    <% end %>
  <% end %>
</ul>
