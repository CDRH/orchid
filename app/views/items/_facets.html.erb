<%# iterate through all of the configured facets
    and match them with the incoming solr facet results %>
<%# TODO refactor the top portion of this %>
<% if facets %>
  <% Facets.facet_info.each do |facet_name, info| %>
    <% if should_display?(facets[facet_name], info) %>
      <% facet_res = facets[facet_name] %>
      <% data_safe_name = facet_name.parameterize  %>
      <% fparams = pull_out_fparams %>
      <% start_open = fparams.include?(facet_name) %>
      <% class_in =  start_open ? "in" : "" %>
      <% class_glyphicon = start_open ? "glyphicon-chevron-down" : "glyphicon-chevron-right" %>

      <div class="panel panel-default">

        <!-- panel heading -->
        <div class="clearfix panel-heading" data-toggle="collapse" data-target="#fc-<%= data_safe_name %>" aria-label="Show <%= info['label'] %> Filters" role="Option">
          <h3 class="pull-left panel-title"><%= info["label"] %></h3>
          <span class="pull-right glyphicon <%= class_glyphicon %>" aria-hidden="true"></span>
        </div>

        <!-- panel body -->
        <%# if requested parameter, then do not collapse facet %>
        <div class="panel-body collapse <%= class_in %>" id="fc-<%= data_safe_name %>">
          <ul class="list-unstyled">
            <% facet_res.each do |key, value| %>
              <% selected = facet_selected?(facet_name, key) %>
              <% label = create_label(key, "No Label") %>

              <!-- list item -->
              <% if !selected %>
                <li>
                  <%= link_to label, search_path(facet_link(facet_name, key)) %>
                  <span class="badge"><%= value %></span>
                </li>
              <% else %>
                <li class="selected">
                  <span><%= key %></span>
                  <span class="badge"><%= value %></span>
                  <%= link_to search_path(remove_facet(facet_name, key)) do %>
                    <button class="btn btn-default btn-xs" aria-label="Clear <%= info['label'] %> Filter" title="Clear <%= info['label'] %> Filter">
                      <span class="pull-right glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                  <% end %>
                </li>
              <% end %>
            <% end %>
          </ul>

          <%= link_to "See more", browse_facet_path(facet_name.parameterize(separator: ".")), class: "btn btn-info btn-xs" %>
        </div> <!-- /panel-body -->

      </div> <!-- /panel panel-default -->
    <% end %>
  <% end %>
<% end %>
